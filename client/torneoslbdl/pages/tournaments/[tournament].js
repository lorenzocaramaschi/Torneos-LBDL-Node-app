import Head from "next/head";
import TournamentStats from "../../components/tournaments/TournamentStats";
import TournamentMatches from "../../components/tournaments/TournamentMatches";
import Image from "next/image";

// generates the paths that Next.js should statically generate based on the tournaments returned from /torneos
export const getStaticPaths = async () => {
  const res = await fetch(`${process.env.host}/torneos`);
  const data = await res.json();

  const paths = data.data.map((tournament) => {
    return {
      params: { tournament: tournament.name.toString() },
    };
  });

  return {
    paths,
    fallback: false,
  };
};

// fetches the tournament matches and information for the specific tournament based on tournamentName, stored in params
export const getStaticProps = async (context) => {
  const name = context.params.tournament;
  const res = await fetch(`${process.env.host}/torneos/${name}/partidos`);
  const data = await res.json();

  const response = await fetch(`${process.env.host}/torneos`);
  const allTournaments = await response.json();
  const tournament = allTournaments.data.filter(
    (tournamentEl) => tournamentEl.name === name
  );

  return {
    props: {
      tournamentMatches: data,
      tournament: tournament,
    },
  };
};

const Details = ({ tournament, tournamentMatches }) => {
  return (
    <>
      {/* set the page's <title> and <meta> tags based on the tournament name and logo */}
      <Head>
        <title>{tournament[0].name}</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href={tournament[0].logo} />
      </Head>
      <main>
        <Image
          alt={tournament[0].name}
          width="169"
          height="169"
          src={tournament[0].logo}
        />
        <h1>{tournament[0].name}</h1>
        {/* We send tournament name and tournament matces as props, to get the TournamentStats */}
        <TournamentStats
          tournament={tournament}
          tournamentMatches={tournamentMatches}
        />
        {/* We simply pass tournament matches to its component respectively */}
        <TournamentMatches tournamentMatches={tournamentMatches} />
      </main>
    </>
  );
};

export default Details;
