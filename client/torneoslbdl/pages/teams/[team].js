import { PlayDisabled } from "@mui/icons-material";
import Head from "next/head";

export const getStaticPaths = async () => {
  const res = await fetch(`http://localhost:3001/equipos`);
  const data = await res.json();

  const paths = data.data.map((team) => {
    return {
      params: { team: team.name.toString() },
    };
  });

  return {
    paths,
    fallback: false,
  };
};

export const getStaticProps = async (context) => {
  const name = context.params.team;
  const res = await fetch(`http://localhost:3001/equipos/${name}/historial`);
  const data = await res.json();

  const response = await fetch("http://localhost:3001/equipos");
  const allTeams = await response.json();

  return {
    props: { team: data, allTeamData: allTeams },
  };
};

export const Details = ({ team, allTeamData }) => {
  let awayLogo = "";
  let homeLogo = "";

  const getLogo = (teamName, condition) => {
    allTeamData.data.map((el) => {
      for (let i = 0; i < team.data.length; i++) {
        if (teamName === el.name) {
          homeLogo = el.logo;
          awayLogo = el.logo          
        } 
      }
    });

    if (condition === "away") {
      return awayLogo;
    } else if (condition === "home") {
      return homeLogo;
    }
  };

  return (
    <>
      <Head>
        <title>Torneos de La Banda del Lobo</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="matches-container">
        {team.data.map((el) => (
          <div key={el._id} className="match-container">
            <div className="match-tournament-info">
              <p>{el.tournament}</p>
              <p>{el.round}</p>
            </div>
            <div>
              <div className="team-score">
                <div className="team-data">
                  <img
                    alt={`Escudo ${el.home}`}
                    src={getLogo(el.home, "home")}
                    width="30rem"
                    height="30rem"
                  />
                  <p>{el.home}</p>
                </div>
                <p>{el.homeScore}</p>
              </div>
              <div className="team-score">
                <div className="team-data">
                  <img
                    alt={`Escudo ${el.away}`}
                    src={getLogo(el.away, "away")}
                    width="30rem"
                    height="30rem"
                  />
                  <p>{el.away}</p>
                </div>
                <p>{el.awayScore}</p>
              </div>
            </div>
            <div className="match-video">
              {el.video === null ? (
                <PlayDisabled />
              ) : (
                <iframe
                  width="140rem"
                  height="100rem"
                  src={el.video}
                  title={`${el.home} vs ${el.away}`}
                  frameBorder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowFullScreen
                ></iframe>
              )}
            </div>
          </div>
        ))}
      </div>
    </>
  );
};

export default Details;
